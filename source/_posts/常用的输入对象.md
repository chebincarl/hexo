---
layout: title
title: 常用的输入对象
date: 2019-02-27 22:44:54
tags: Unity
---
# 常用的输入对象

在游戏的开发过程中，时常需要获取用户的输入情况，类似于手机或平板中的触控行为，计算机端的键盘鼠标操作行为等，在其他的开发平台中，要获取这些操控参数往往需要通过开发人员编写不少代码来实现，而Unity 3D引擎在设计时就封装好了这些常用的方法与参数。

针对用户的输入，引肇专门为开发人员提供了两个输入对象--Touch与Input。开发人员通过Touch与Input输入对象中的方法以及参数可以非常方便地获取用户输入的各种参数，包括触控的位置、相位、手指按下位移，以及用户鼠标键盘的输入等。

<!--more-->

## Touch输入对象

Touch输入对象中提供了非常详细的参数以及方法，通过使用该对象可以获取如Android、IOS等移动平台中的详细的触摸操控信息，读者可以将分析Touch的代码写在对应的脚本中，然后挂载到对应的游戏对象上，就可以轻松地获取到Touch的信息了。 Touch事件变量如下表所示。

| 变量名  | 含义  |
| :------------ | :------------ |
|  fingerID |  手指的索引 |
|  position | 手指的位置  |
|  deltaPosition | 距离上次改变的距离增量  |
|  deltaTime |  自上次改变的时间增量 |
|  tapCount | 点击次数  |
|  phase |  触摸相位 |

Touch触摸输入对象的各个参数在开发的过程中一般都是相互配合使用的，只有这样才能符合开发的需要。接下来将给出一个解析玩家手势操控的案例，希望读者可以通过该案例与学习的内容进行相互印证以加深理解。

1.首先搭建所需的游戏场景。新建一个场景并将其命名为“TouchTest”，在其中创建一个平行光Direction Light，然后执行“GameObject->3D Object->Sphere”命令，创建一个小球并赋予其纹理图。调整小球的大小与位置以及摄像机的位置,如下图所示。

2.简单地搭建好场景后接下来进行脚本的开发。新建一个名为“TouchTest.cs”的C#脚本，将其挂载到主摄像机MainCamera上。脚本代码如下：
```cs
using UnityEngine;
using System.Collections;

public class TouchTest: MonoBehaviour 
{
	public GameObject ball;  // Sphere游戏对象的引用
	private float lastDis = 0;  // 上一次两个手指的距离
	private float cameraDis = -20;  // 摄像机距离球的距离
	public float ScaleDump = 0.1f;  // 缩放阻尼

	void Update() {
		if (Input.touchCount == 1)  // 触控
		{ 
			Touch t = Input.GetTouch(0);  // 获取触控
			if (t.phase == TouchPhase.Moved) // 手指移动中
			{  
				ball.transform.Rotate(Vector3.right, Input.GetAxis("Mouse Y"), Space.World); // 竖直旋转
				ball.transform.Rotate(Vector3.up, -1*Input.GetAxis("Mouse X"), Space.World);// 水平旋转
			}
		} else if (Input.touchCount > 1)
		{
			Touch t1 = Input.GetTouch(0);  // 获取触控
			Touch t2 = Input.GetTouch(1);  // 获取触控
			if (t2.phase == TouchPhase.Began) // 开始触摸
			{ 
				lastDis = Vector2.Distance(t1.position, t2.position); // 初始化lastDis
			} elseif (t1.phase == TouchPhase.Moved && t2.phase == TouchPhase.Moved) // 两个手指都在移动
			{ 
				float dis = Vector2.Distance(t1.position, t2.position); // 计算手指位置
				if (Mathf.Abs(dis -lastDis) > 1)  // 若是手指距离>1
					cameraDis += (dis - lastDis) * ScaleDump;  // 设置摄像机到物体的距离
					cameraDis = Mathf.Clamp(cameraDis, -40, -5); // 限制摄像机到物体的距离
					lastDis = dis;  // 备份本次触摸结果
			}
		}
	}

	void LateUpdate()
	{
		this.transform.position = new Vector3(0, 0, cameraDis); // 调整摄像机的位置
	}
	
	void OnGUI()
	{
		// 打印信息与退出按钮
		string s = string.Format("Input.touchCount={0}\ncameraDIS=\n{1}",Input.touchCount, cameraDis);  // 打印字符
		GUI.TextArea(new Rect (0, 0, Screen.width / 10, Screen.height), s); // 用Text控件显示字符串
		if (GUI.Button(new Rect (Screen.width *9/10, 0, Screen.width / 10, Screen.height / 10), "quit")) // 退出按钮
		{
			Debug.Log("quit");  // 打印点击信息
			Application.Quit();  // 退出程序
		} 
	}  
}
```

口第1-7行的主要功能为命名空间的引用以及声明变量。在声明变量的部分中声明了场景中的Sphere游戏对象的引用Ball，方便下面对其进行旋转等变换；同时还声明了一些数据全局变量，用途将在下面的讲解中进行介绍。
口第8-14行代码是在Update方法中对单指操控行为进行解析。当发生触控并且用户的手指在移动状态，就可以通过Input.GetAxis("Mouse XY")获取用户的手指位移，然后将其转换为旋转角对ball进行旋转。运行时就可以看到，当用户滑动手指时，场景中的小球根据滑动方向进行旋转。

口第15-27行是解析用户多点操控的行为，当手指数目大于1时,计算两个手指问的距离，并与上一次计算出的距离进行比较，若是距离变大就将摄像机向近推产生放大的效果，反之摄像机向后推就可以得到缩小的效果。这里还在第25行对摄像机的位置进行了限制，使其不能无限放大或者缩小。最后备份下这一帧中手指间的距离用于下一帧中和新的距离进行比较。

口第28-30行为对LateUpdate方法的重写，这个方法在Update方法回调完后进行回调。在这部分中根据上一步算出来的cameraDis对摄像机进行前推或者后拉，产生放大或者缩小的效果。

口第31-39行代码与触控的检测没有什么关系，主要是使用Text控件对触控的信息进行打印，使其在真机上也可以看到，方便学习与调试，最后还设置了一个退出按钮，单击该按钮后程序结束运行。

在第12,13行中使用了Input.GetAxis("Mouse XY")来获取用户手指的位移而没有使用Touch. deltaPosition，这是因为手机屏幕的不同Touch. deltaPosition的返回值是不同的，所以使用起来比较不方便；而Input.GetAxis("Mouse X/Y")也可以实现相应的效果，并且在iOs平台中也可以使用该方法。具体使用哪个，读者可以根据开发需要自行选择。

(3)将案例导入手机中运行，就可以看到小球根据玩家的手指滑动或两指放大收缩而发生旋转或缩放了。需要注意的是,与Touch有关的项目都需要在真机上进行测试。

## Input输入对象
如果说Touch输入对象可以用于获取用户的触摸操作信息，那么Input对象就可以获取用户其他所有行为的输入，如鼠标、键盘、加速度、陀螺仪、按钮等,所以掌握Input输入对象就可以在外部输入信息和系统之间架立一座桥梁，因此显得其尤为重要。Input对象的主要变量如下表所示。