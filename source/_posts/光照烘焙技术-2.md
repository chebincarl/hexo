---
layout: title
title: 光照烘焙技术-2
date: 2019-04-04 15:46:54
categories: Unity
tags: Unity5.X 完全自学手册
---
本章涵盖：
* “高动态光照”反射探头技术
* Light Probes概述

<!--more-->

# “高动态光照”反射探头技术

在现实世界中，当太阳光照到场景物体上时，物体会有一些间接光反射到地面上，或者地面上的光反射到物体上，或者物体与物体之间光反射。在Unity中反射探头技术使我们可以模拟自然界中光线与光线之间的相互融合的特点，使物体可以接受其他物体光源的影响，这样可以更好地模拟自然界的光照的特点。

在Hierarchy视图中添加Reflection Probe，如下图所示。

{% asset_img 2.png %}

添加Reflection Probe以后，场景中会出现一个圆球，圆球外围会有一个Box形状的框，框内的场景都会受到Reflection Probe的影响。我们可以通过Inspector面板更改Reflection Probe的属性，如下图所示。

{% asset_img 1.png %}

通过调整边界按钮和调整位置按钮，调整Reflection Probe的探索范围，使探索范围在Refletion Probe的包围范围之内，如下图所示，Refletion Probe可以更好地模拟范围内物体与物体之间间接光的影响。

{% asset_img 3.png %}

{% asset_img 6.png %}

设置好Reflection Probe以后还需要再设置两个步骤才能实现光照探头效果。第一，场景中静态物体还需要再烘焙一次。选中场景中的静态物体，单击Lighting面板上的“Build”按钮，烘焙完成以后在Project视图文件夹中会生成一个名称为ReflectionProbe-0的反射探头贴图文件，如下图所示。

{% asset_img 4.png %}

第二，生成反射探头贴图以后，还需要单击Lighting面板的“Bake Reflection Probes”（烘焙反射探头）按钮，如下图所示。

{% asset_img 5.png %}

完成烘焙反射探头以后，选中Reflection Probes会发现它已经能反射周围的环境，如下图所示。

选择Directional Light，把Mode模式设置为Realtime，通过调整Bounce Intensity的大小，就可以很好地模拟出物体与物体间接光相互的影响。

# Light Probes概述

尽管使用光照贴图可以大大提升场景的真实程度，但是它有一个缺点，那就是场景中非静态物体缺少真实的渲染，看上去就好像和场景格格不入。实时为移动物体计算光照贴图是不可能的，但是通过使用灯光探测器我们可以模拟类似的效果。

## 原理

在场景中的标记为探测器的静态点的位置采样光照，然后对相邻几个光照探测器位置所采样的灯光照明进行差值，在游戏进行的过程中计算差值的速度很快，玩家察觉不到。这样就可以帮助我们避免移动物体的光照和烘焙场景格格不入的感觉。

## 优点

* 1.性能佳，对比实时阴影性能高很多，适合移动平台。
* 2.配合烘焙，配合烘焙效果很好。
* 3.可视化，可以可视化编辑Light Probes的分布，不需要代码。

## 缺点

* 1.烘焙后才能有效果，不能实时改变。
* 2.只能整体进行明暗变化。

## 使用

如场景里面有一个烘焙好的简单场景，有一个第三人称控制器，第三人称控制器是作为动态物体的存在。

由于动态物体不受烘焙的影响，所以第三人称控制器和场景格格不入，如下图所示。

添加灯光探测器，打开菜单栏中的GameObject->Lighting->Light Probe Group选项，如下图所示。



在Light Probe Group选项里面，有添加、选择、删除和复制探头的按钮，如下图所示。

单击“Add Probe”按钮添加探头，放一些探头在场景里面，也可以建一个，然后复制多几个。探测器在场景中用黄色的球体表示，并且可以像其他游戏物体那样编辑移动它的位置，被选择的探测器可以通过键盘快捷键进行复制。最简单的方法为，先在各个角落放一个，把一定范围内的场景包起来。只要选择了Light Probe物体，那么这些探头点就可见，直接用鼠标点选这些探头，可以使用位移工具来移动它们，如下图所示。

在烘焙之前，还需要把场景中的静态物体再烘焙一遍，烘焙之前把Baking模式改变为Baked，然后单击Lighting面板上的“Build”按钮来烘焙场景。烘焙完成以后，Light Probes Group探头点变为白色，烘焙完成，如下图所示。

单击开始游戏按钮，按W、A、S、D键移动第三人称控制器，我们可以发现人物的颜色已经受到环境的影响而发生变化了，这就是说明第三人称控制器受到了Light Probe影响了，如下图所示。

# 小结

Light Probe Group是Unity里面专用于模拟物体靠近发光或反射光物体时，在物体表面映射出发光或反射光物体的颜色。但Light Probe Group在Unity中并不作为实时光的补充部分，而是作为Power VR光源追踪技术和实时全局光照的补充。在进行实时检测之前，必须要添加LightProbe Group，在添加之后会出现许多的圆形探头，用于检测哪些发光或反射光物体周围光的颜色以及强度，所以对这些探头位置的摆放直接关系到后面的检测效果，如果探头的数量不够用，在监视面板中单击“Add Probe”按钮来添加探头的数量。接着就是调出Lighting面板，单击“Build”按钮进行烘焙处理。