---
layout: title
title: 创建第三人称3D游戏：玩家移动和动画
date: 2019-03-12 07:47:21
tags: Unity
---

本章涵盖
* 给场景添加实时阴影
* 使摄像机环绕它的目标
* 使用线性插值（Lerp）算法平滑修改旋转
* 为跳跃、悬崖、斜坡处理地面检测
* 为逼真的角色应用和控制动画

<!--more-->
	
在第一人称视角中，玩家通过他们角色的眼睛来观察周围，而在第三人称视角中摄像机被放置在角色的外部。

	
3D模型这个词和网格对象一样，它是由顶点和多边形（即网格几何）定义的静态形状。对于一个人物角色。这个网格几何体被塑造成头、胳膊、腿等。

	
1将角色模型导入到场景
2实现摄像机控制,以观察角色
3编写脚本,让玩家能够在地面上跑
4添加能够跳跃、移动的脚本
5基于移动来播放模型的动画

	
7.1 调整摄像机视图为第三人称视角
在编写代码让玩家到处移动之前,需要先将一个角色导入场景,并设置摄像机来观察角色。我们将导入一个无脸的人形模型作为玩家角色,然后在上方放置摄像机并以一个角度向下倾观察玩家。

7.1.1 导入一个用于观察的角色
文件中包括了模型和贴图。 FBX是模型而TGA是贴图。将FBX文件导入到项目中,将该文件拖动到Project视图,或者右击项目视图并选择Import New Asset,然后查看Inspector来调整模型的导入设置。在本章后面,你将调整导入的动画,但是现在只需要在Model选项卡上做一些调整。首先,修改Scale Factor的值为10(为了部分抵消文件缩放的0.01),使得模型大小合适。
在Scale Factor设置稍微往下,可以发现Normals选项(见图7-4)。这个设置控制了光线、阴影在模型上的显示,使用了通常所知的称为法线的3D数学概念

定义：
法线(Normals)是垂直于多边形的方向向量,它将多边形的朝向告诉计算机。这个朝向方向用于光照计算。

Normals的默认设置是Import,它将使用定义在导入网格几何体的法线。但是个别模型无法正确定义法线并将以奇怪的方式对灯光做出反应。相反,修改设置为Calculate,以便Unity为每个多边形计算朝向的方向向量。

当修改完这两个设置后,单击Inspector上的Apply按钮。接着将TGA文件导入到项目,并将这张图片赋予材质的贴图。在Materials文件夹中选择player材质。将贴图图像拖到Inspector上的空的贴图槽。应用贴图之后,不会看到模型颜色发生了巨大的变化(贴图图像大多是白色)。但绘制在贴图的阴影,将改善模型的外观。

应用贴图后,把玩家模型从Project视图拖到场景中,设置角色位置为(0, 1.1.0),以便玩家位于房间的中心并且举起站在地板上。很好,现在场景中有一个第三人称的角色。
注意:
这个导入的角色有双臂,垂直两侧,而不是更自然的双臂向下姿态。这是因为还没有应用动画,这样的姿态被称为T形姿态,在动画角色播放动画前,它们的标准默认姿态是,T形姿态.

7.1.2将阴影添加到场景
我们在真实世界里理当有阴影,但在虚拟的游戏世界中却不一定。很幸运Unity能处理这个细节,阴影通过场景中默认的灯光来打开。选择在场景中的平行光,然后在Inspector中找Shadow Type选项。作为默认的灯光,设置已经开启Soft Shadows(如图7-5所示)。但注意菜单中也有一个No Shadows选项。


你所需要做的是在这个项目中创建阴影,但还有很多关于游戏阴影方面的知识你应该知道。计算场景阴影是计算机图形学中特别耗时的一部分。所以游戏往往以不同的方式偷工减料,以达到所需的视觉外观要求。这种角色投影被称为实时阴影,因为阴影的计算是在游戏运行时和跟随移动对象移动时完成的。一个很真实的灯光设置会让所有的对象在实时接收和投射光线,但为了使得阴影计算运行得足够快,实时阴影限制了阴影看起来的外观或者哪个灯光可以投射阴影。注意,在这个场景中只有平行光投射阴影。

在游戏中处理阴影的另一种常见方式是使用一种称为光照贴图(lightmapping)的技术。


定义:
Lightmaps是应用到平面几何体的贴图,这个几何体的阴影被烘焙到贴图图像中。
定义:
把阴影绘制到模型贴图上,这种技术被称为烘焙阴影.

因为这些图像是预先生成的(而不是在游戏运行时生成),所以它们可以非常复杂和真实。缺点是,因为阴影提前生成,所以它们不能运动。因此,光照贴图被广泛用于静态平面几何体,而不用于类似角色等动态对象上。光照贴图自动生成而不用手工绘制。计算机计算场景中的灯光如何照亮关卡,而角落边上则是隐约的黑暗。在Unity中,渲染光照贴图的系统称作Enlighten,你可以在Unity的手册中查找该关键字。

使用实时阴影或光照贴图,并不是一个非此即彼的选择。你可以设置灯光的CullingMask属性,使得实时阴影只用于确定的对象,同时允许你在场景中将高质量的光照贴图用于其他对象。同样,虽然你几乎总是让主角投射阴影,但有时可能不想让这个角色接收阴影,所有网格对象都有投射和接收阴影的设置(见图7-6).

	
定义:
Culing这个术语通常是指移除不必要的东西,这个词在计算机图形学的许多不同情况下多次出现。但在此culling mask是指你想从阴影授射移除的一系列的对象。
你现在明白了有关如何在场景中应用阴影的基础知识。场景中的灯光和阴影本身是一个很大的话题(关于关卡编辑的书往往在光照贴图上就占用了很多章节)。在这里限制在一盏灯上打开实时阴影。

7.1.3摄像机环绕玩家角色
在第一人称示例中,在Hierarchy视图中,摄像机和玩家关联在一起,所以它们会一起旋转。然而,在第三人称的移动示例中,玩家将独立于摄像机朝向不同的方向。因此这次,在Hierarchy视图上你不会把摄像机拖到角色上。相反,摄像机的代码将跟随玩家角色移动其位置,但独立于摄像机做旋转。

首先,把摄像机放置在相对于玩家的位置,为了把摄像机放在玩家的后上方,把位置设置为(0, 3.5,-3.75(如果有必要,把旋转重置为0,0,0),然后创建OrbirCamera脚本(参见代码清单7.1),将这个脚本组件添加到摄像机上,然后把玩家角色拖到这个脚本的Target字段的空槽上。现在可以运行场景,看到在运行的摄像机代码效果。