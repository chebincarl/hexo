---
layout: title
title: 材质
date: 2019-05-20 11:51:30
categories: Unity
tags: 大话Unity2018
---
思考题：
动手创建一个材质，尝试修改其中的各个参数，看看有什么效果。

<!--more-->

材质是连接贴图、着色器和模型的重要资源。

# 创建材质

在Project窗口任一文件夹或空白处右键，Create > Material可以创建一个新的材质。

新创建的材质默认会被设置为Standard着色器，所有贴图属性为空，如下图所示：

{% asset_img 1.png %}

材质创建后，可以在Project窗口中选中，在Inspector中修改其所有属性。

将材质拖拽到场景或Hierarchy中的任一物体即可将材质赋予对应的物体。

** 注意 **

如果一个模型有多个材质，不要使用拖拽的方式赋予材质，否则会将多个材质全部替换为拖拽的材质。正确的做法是：将材质拖拽到模型Mesh Renderer的Materials列表的对应位置。

# 编辑材质

编辑材质的第一步是确定要使用的着色器，可以点击材质的Shader下拉菜单选择着色器。

{% asset_img 2.png %}

选中的着色器决定了材质包含的可配置的属性。

属性的类型包括颜色、滑条、贴图、数字、向量。如果将材质赋予了场景中的模型，修改属性会实时反馈到场景的模型上。

其中修改贴图属性有两种办法：

* 将贴图从Project窗口中拖到材质的贴图属性的小方框中（最常用）

{% asset_img 3-1.png %}

* 点击材质属性的小圆点，可以从列表中选择贴图

{% asset_img 3.png %}

** 小技巧 **

Ctrl+点击贴图的小图标，可以预览贴图。

{% asset_img 4.png %}<center>Ctrl+点击红框位置可以预览贴图</center>

# 内置着色器

Unity除了内置的Standard着色器外，还内置了一些其他类型的着色器：

| <center>** 着色器 ** </center>  | <center>** 用途 ** </center>  |
| :-| :- |
| FX  | 照明和玻璃效果。  |
| GUI和UI  | 用于用户界面图形。  |
| Mobile  | 经过简化的适用于移动设备的高性能着色器。  |
| Nature  | 适用于树木和地形。  |
| Particles  | 用于粒子系统特效  |
| Skybox  | 在场景中所有的模型背后渲染的背景环境  |
| Sprites  | 用于2D精灵系统  |
| Toon  | 卡通风格的渲染。  |
| Unlit  | 用于不需要光照和阴影的渲染  |
| Legacy  | 旧的Unity版本中的着色器，已经被Standard着色器取代  |

当你需要使用对应的效果时，可以先去里面看看有没有合适的Shader。

# Shader技术细节

我们都知道在Unity里写代码需要用C#语言，不过Shader是一种比较特殊的代码，用来处理图形的显示。

Shader代码里包含了一系列数学计算和算法，用于将模型的顶点位置和表面颜色计算出来。比如Unity内置的Standard着色器内处理了复杂的真实光照计算。

Shader代码中定义的属性，可以通过Material的界面进行赋值。材质会被游戏物体上的Renderer组件引用，来渲染游戏物体的每一个网格。

不同的材质可以引用同一张贴图，这些材质可以是相同或不同的着色器。

如下图所示，一共有三个材质，使用了2个Shader和一张贴图。

{% asset_img 5.png %}

上图中有一辆红色汽车和一辆蓝色汽车。两款车型分别使用单独的车身材质，分别为“Red car material”和“Blue car material”。

这两种车身材质都使用相同的自定义着色器“Carbody Shader”。使用自定义着色器的原因是汽车的渲染需要额外的功能，例如金属闪烁效果、自定义的损坏遮罩贴图功能（可以在车身的某一块增加划痕、擦碰等效果）。

每个车身材质都有一个对“Car Texture”贴图的引用，这是一个包含车身所有细节的贴图，但是没有特定的颜色。

Carbody着色器还可以接受设置自定义颜色，红色和蓝色汽车使用同一张贴图，只需要设置不同的颜色，就能为每辆汽车提供不同的外观。

车轮模型使用了单独的材质，但是这两辆车的车轮共用了同一个材质，因为两辆车上的车轮没什么差别。轮子材质使用标准着色器，并再次使用了Car Texture贴图。

注意这里仅使用了一张汽车贴图就包含车身和车轮的细节，这种做法叫做<span style="color:red;">Texture Atlas（纹理图集）</span>，贴图的不同部分映射到了模型的不同部分。<span style="color:red;">使用Texture Atlas可以提高游戏的性能。</span>

你可能注意到，车身材质使用贴图中也包含了车轮图像，但车轮并未出现在车身上，这是因为该部分纹理未映射到车身上。

同样，轮子材质使用相同的贴图，贴图中有车身细节。但车身细节未出现在车轮上，这是因为只有显示车轮细节的贴图部分映射到车轮上。

该映射是由美术同学在外部3D建模程序中完成的，叫做“UV映射”。

# 总结

Shader定义了：

渲染物体的方法。包括代码和数学计算，可能包括光源角度，视角和任何其他相关计算。着色器也可以根据最终用户的图形硬件来选择。

可以在材质Inspector中自定义的参数，例如贴图，颜色和数值。

材质定义了：

使用哪种着色器渲染此材质。

着色器参数的具体值 - 例如使用哪些纹理贴图，颜色和数值。

自定义着色器由开发同学编写，使用ShaderLab语言创建，复杂的会涉及到Cg/HLSL语言。不过，让着色器在各种显卡上运行良好是一项有难度的工作，需要对显卡的工作原理有相当全面的了解。