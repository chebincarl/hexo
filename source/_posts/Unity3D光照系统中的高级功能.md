---
layout: title
title: Unity3D光照系统中的高级功能
date: 2019-05-04 14:21:44
categories: Unity
tags: Unity游戏开发技术详解与典型案例
---
Unity光照系统中不仅仅是几个光源投射阴影这么简单，还包括有很多有趣的功能比如镜头光晕、光环、剔除等，这些小功能在某些时候可以极大地美化场景，使场景更加真实。此外，还有Light Probes来优化场景的阴影效果。

<!--more-->

# 渲染路径与颜色空间

了解Unity的具体光照功能前，首先需要了解Unity中的光影效果的场景设置即渲染路径和颜色空间。这些功能与光照或阴影的渲染有关，通过对其设置可以配合对应的设备产生更加真实的光影效果和配色方案，下面将对其进行详细的介绍。
    
** 1.渲染路径 **

Unity支持许多渲染路径（Rendering Path），而用户在使用的时候需要根据自己场景的实际情况以及目标平台和硬件的支持情况来进行选择。不同的渲染路径有不同的性能和效果，大多数都是影响光照和阴影的，比如需要点光源和区域光源显示阴影时就需要将渲染路径设置为“Legacy Deferred”或“Deferred”。

Unity 5.0中设置渲染路径的步骤为“Edit->Project Settings->Player”。在Inspector面板中的Other Settings卷展栏下的Rendering Path选框，如下图所示，主要有4种渲染路径下面将对其进行一一介绍。

* Forward

该渲染路径也是Unity的预设渲染路径，在该渲染路径，每个对象的着色是根据影响对象的灯光，通过“Pass”来着色，所以当一个物体同时在多个光源的作用范围内时，该对象会被重复着色多次。这个渲染路径的优点是快速，硬件要求低，可以快速处理透明度。然而其缺点是要为每盏灯付出相应的成本，在有大量光源的复杂场景中效率反而会降低。

* Deferred

该路径为延迟渲染路径，延迟了光的遮蔽与混合信息直到第一次接收到表面的位置发现材质数据着色到一个“几何缓冲器（G-buffer）"作为一个屏幕空间的贴图。该方法的优点是照明的着色成本和像素数量成正比，而非灯光数量，所以非常适合在有大量realime模式的光源存在时显示真实的光照和阴影，但是需要较高的硬件水平支持。

* Legacy Vertex Lit

顶点照明渲染路径通常在一个pass中渲染物体，所有的光源照明都是在物体的顶点上计算的。该渲染路径是最快速的，并且具有最广泛的硬件支持（不能工作在游戏机上）。由于所有的光照都是在顶点层级上计算的，所以此渲染路径不支持大部分逐像素渲染效果，如阴影、法线贴图、灯光遮罩、高精度的高光等。

* Legacy Defferred (Light prepass)

该渲染和Defterred渲染路径非常相似，只是采用了不同的手段去实现，需要注意的是，该渲染路径不支持Unity 5.0中的physically based standard着色器。

** 2.颜色空间 ** 

设置好渲染路径后，选择一个颜色空间(Color Space)也是非常重要的，色彩空间决定采用哪种算法来计算照明或者材质加载时的颜色混合，这会对游戏画面的真实感有非常大的影响。一般情况下，超过色彩空间设定可能会被目标平台强制限制。

颜色空间的设定步骤为"di-ProjeetStings-Player", Inspector面板中的Other Settings卷展栏下的Rendering Path选框，如图9-56所示，通常推荐的比较接近真实的是Linear颜色空间。其优点是场景内提供给着色器的颜色会因为光强增加边亮，,如果换成Gamma色彩空间，亮度马上会转为以白色作为参考，可能会导致照明在有些部位太亮。如下图所示。

Linear颜色空间的另一个好处是着色器能在没有Gamma补偿的情况下对贴图进行采样，这有助于确保颜色质量在经过着色通道后还能保持一致性，能提高颜色和计算的精度，最后屏幕的输出会更加真实，但是目前有些手机平台不支持Linear，在这种情况下就需要使用Gamma替代了..  ......

切换颜色空间后场景中已经烘焙好的Lightmap需要重新烘焙(在默认的情况说明:下这是Unity引掌自动完成的)。

# Cookies

灯光中的Cookies是一个很有趣的功能。在很早的电影或戏曲中灯光特效就被用来产生一个没有真实存在的物体的印模或轮廓，比如丛林中产生的假象的树冠阴影、监狱中栏杆的阴影等，这些效果可以极大地提升场景的真实感，Unity也支持这种效果，就是灯光中的Cookies参数，如下图所示。
