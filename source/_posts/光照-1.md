---
layout: title
title: 光照-1
date: 2019-04-11 06:34:47
categories: Unity
tags: Unity5.X游戏开发指南
---
光照是场景里非常重要的部分，网格模型和贴图决定了物体的外形和图案，光照决定了场景的颜色和情绪。一个场景里可能需要处理多个灯光，处理得当会让整个场景有惊艳的画面感。

<!--more-->

# 光照基础

光有3个基本组成部分：Intensity（强度）、Color（颜色）和Direction（方向）。

新建一个场景，选取Directional Light，属性如下图所示。我们可以直接设置Intensity和Color，而方向是由光照类型Type决定的。

{% asset_img 1.png %}

Unity中一共有4种光照类型：点光源、聚光源、方向光和区域光。

## 点光源

点光源（Point Light）基于空间中的一点，均匀地向四面八方发送光。光照强度随着距离衰减，最小强度为0。点光源经常用于模拟由灯泡发出的光、开枪的瞬间发出的火花，或者爆炸时的强光。

## 聚光源

聚光源（Spot Light）和点光源一样，也是从某一点发出光。不同的是，它是在一个角度范围内发出光，所以是一个圆锥形，想象一下手电筒的发光就很清楚了。它的方向是Z轴正向，主要用于表现手电筒和车灯等。

## 方向光

方向光（Directional Light）并没有具体的光源位置，所以会对整个场景进行照射。它可以置于任意位置，也没有距离的概念，因为光的强度不会衰减。

方向光主要用来表现非常大的光源从场景模型空间投射过来，例如阳光或者月光。在抽象化的游戏中，也可以用来让物体受到光照，并产生阴影，从而增加画面感。

## 区域光

区域光（Area Light）在空间中以一个矩形展现，如下图所示，光从矩形一侧照向另一侧会衰减。因为区域光非常占用CPU，所以是唯一必须提前烘焙的光源类型。

{% asset_img 2.png %}

因为区域光从不同的角度照射物体，所以明暗变化更柔和，可以用来模拟街灯。

# 光的使用

在Unity中，光的创建和使用都非常简单。

例如创建方向光，点击导航菜单栏->GameObjet->Light->Direcitonal Light。在Scene窗口中有一个太阳形状的按钮，默认是按下状态。当按下时，直接在Scene窗口中就能看到光照的效果。

方向光一般用来表现阳光，方向光稍微朝下并和场景模型最好有些角度。例如一个立方体，如果方向光垂直其一面照射，那么立体感不会太明显；如果斜着照射，那么立体感会强很多。

一般把点光源或者是聚光源置入场景时，可能会看不出效果，调整范围和角度以达到更好的效果。

# 阴影

Unity中受到光源照射的物体会投射阴影（Shadow）到物体的其他部位或其他物体，本节我们来介绍阴影的作用。

## 开启光的阴影

选中Light，在Inspector窗口中，可以通过Shadow Type一栏设置阴影，有3个选项：No Shadows（无阴影），Hard Shadows（硬边缘阴影）和Soft Shadows（软边缘阴影）。

No Shadows不造成阴影，Hard Shadows产生边缘硬朗的阴影，甚至是锯齿，没有Soft Shadows效果好，但是运行效率要高，并且效果也是可以接受的。Strength决定了阴影暗的程度，通常光会被空气分散，并反射到其他物体，所以这个值一般不会设为最大值。Resolution分辨率是指Shadow Map的分辨率，如果想要比较清晰的阴影边缘的话，需要设置高分辨率。

每个Mesh Renderer都有两个参数。
* Cast Shadows：是否投射阴影。
* Receive Shadows：是否接受阴影。

{% asset_img 3.png %}

一般这两个参数都是默认开启的，也就是所有创建的物体默认会投射阴影也会接受阴影，我们只要确保光的Shadow Type设置为Hard Shadows或者Soft Shadows，那么阴影功能就是开启的。

## 阴影技巧

关于阴影，还有一些细节需要注意:方向光的阴影、阴影距离、阴影层以及支持阴影的设备。

1.方向光的阴影
方向光通常模拟阳光，一个光就照亮整个场景。它的Shadow Map需要覆盖大部分场景，因此在阴影细节上的分辨率不够，特别是距离摄像机很近的阴影， “被放大了”会出现马赛克的效果。如图12-9所示，距离摄像机远的球体阴影效果不错，但随着与摄像机距离的拉近，阴影被放大的效果越来越差。

这个问题在使用Soft Shadow并将Shadow Map设置为高分辨率时不明显，但是这么设置的话.会消耗性能导致低帧率。

2.阴影距离
要提升阴影画面质量和性能，还有一个很重要的办法，就是把阴影距离（ Shadow Distance设置得尽量小。该值越小，需要绘制在Shadow Map的物体就越少。特别是在没有阴影级联的移动平台，设置较小的阴影距离是移动平台提高质量最有效的办法。

3.阴影级联
阴影级联（Shadow Cascade）是方向光独有的一个技术，移动平台不支持。在QualitySettings界面中有Shadow Cascade参数设置，有NoCascades（无阴影级联），Two Cascades（2张阴影级联）、Four Cascades（4张阴影级联）3个选项。数量越高，方向光的阴影效果越好。使用4张Shadow Cascade的效果如图12-10所示。

{% asset_img 4.png %}

点击Scene窗口的"Shaded"按钮，选择Shadow Cascades模式，可以以不同的颜色显示Cascades图，如图12-11所示。