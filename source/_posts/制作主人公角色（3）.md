---
layout: title
title: 制作主人公角色（3）
date: 2019-04-17 09:26:52
categories: Unity
tags: Unity5权威讲解
---
本章涵盖：
* 实时阴影
* 运用投影器制作阴影
* 运用平面网格制作阴影

<!--more-->

# 实时阴影
Unity支持3种光源的实时阴影，即平行光、点光源、聚光灯。

点光源和聚光灯也支持实时阴影（需要根据移动设备性能决定是否使用）。


请仔细观察截图，可以看出其使用了实时阴影。

下面两个截图分别取自iPhone 4和iPhone 4S的实际游戏画面。可以发现，只有iPhone 4s（右）使用了实时阴影。实时阴影的处理负荷很大，所以需要根据移动设备的处理速度决定是否使用。
 
随着移动设备性能的提高，各种实时阴影均在Unity中获得支持。Unity IDE中，可通过Inspector视图Directional Light属性Shadow Type选项设置实时阴影。Shadow Type有No Shadow、Hard Shadows、Soft Shadows这3种，如果设置为Hard Shadows和Soft Shadows，则可使用Unity提供的实时阴影功能，如下图所示。

* No Shadows：默认设置值，不使用实时阴影。
* Hard Shadows：使用实时阴影，但阴影边缘处理不自然。
* Soft Shadows：虽然可以表现较为自然的实时阴影，但计算负荷很大。

实时阴影的视觉效果虽然很棒，但它会为引擎带来很高的负荷。因此，实际开发游戏时，必须将不需要实时阴影效果的3D模型的实时阴影属性设定为No Shadows。

3D模型默认具有Mesh Renderer组件或Skined Mesh Renderer组件，这两个组件均有与实时阴影有关的属性，即Cast Shadows和Receive Shadows。

* Cast Shadows：决定有光照时是否需要投射自身阴影。
| 属性  | 含义  |
| :------------ | :------------ |
| Off  | 不产生阴影  |
| On  | 产生阴影  |
| Two sided  | 忽略Back face curling，双面制作阴影  |
| Shadows Only  | 生成阴影，但不需要自己渲染，可用于仅处理阴影的3D模型  |

* Receive Shadows：当前模型能否显示其他模型投射到自己身上的阴影。

即使3D模型不使用实时阴影，也不会对画面产生太大影响。需要取消这两个选项的勾选，以免游戏消耗过多计算资源。

** 关于Cast Shadows属性的Two Sided选项 **

游戏模型为Plane或Quad时，Unity将只渲染Single-Side。此时如果将其Cast Shadows属性设为On，那么即使光从后面照过来也不会生成阴影（图4-38中图）；如果设置为TwoSided选项，则可生成阴影（图4-38右图）。

Scene视图中，用鼠标点击3D模型手中的枪，则会选中Hierarchy视图PlayerModel下的main.weapon001，如下图所示，将Mesh Renderer组件的Cast Shadows属性设为Off，并去掉Receive Shadows选项的勾选。

4.15运用投影器制作阴影
下面学习如何用Unity提供的投影器( Projector )制作Player的阴影。先将平行光的阴影属性改为

No Shadow.

Unity提供的投影器可以简单理解为投射灯在屏幕中照射图像,主要用于构建Decal,以表现阴影、枪弹痕迹、血迹等。

Unity提供的投影器为Unity资源包形式。在项目视图中右击鼠标,并在上下文菜单中选择ImportPackage → Projectors,或在菜单中选择Assets- Import Package - Effects,出现导人资源包窗口。此处只选择导入投影器相关资源。在Importing Package窗口底端按钮中点击None按钮,取消全选,只选择所需投影器文件夹,最后点击Import按钮。

导人投影器资源包后,项目视图中会自动生成Standard Assets文件夹。

Standard Assets 包内含3个投影器预设。将Blob Shadow Projector拖变到层次视图Player游戏对象下,然后将投影器以x轴为轴心向下旋转90。再选择Z轴,向上方移动,使其边框包含Player游戏对象。此时,地面上生成模糊阴影。

Player游戏模型本身也被覆盖了阴影,所以需要将投影器的Near Clip Plane属性值修改为6.0左右。如图4-44所示,可以通过修改此值指定阴影范围。实际开发时的需求可能不同,需要自行调节Near Clip Plane数值。

投影器中, 3D模型离Near Clip Plane越近,则阴影纹理越深;离Far Clip Plane越近,则阴影纹理越淡。因此, Player跳离地面时,地而上的影子会根据Player高度的增高而逐渐变淡。

除了通过调节投影器的Near Clip Plane和Far Clip Plane属性设置阴影范围外,还可以通过IgnoreLayers属性设置阴影范围,下面学习如何利用其修改阴影。首先需要新建图层,创建方法与添加标签的方法类似。

在菜单中选择Edit- Project Settings -Tags and Layers或点击检视视图顶端的Layer,在弹出菜单中选择Add Layer...此时,检视视图显示Tags & Layer项目,可以在此设置Tags, Srting Layers,Layers等。序号为1-7的层是Unity默认分配的层,可以从8号开始使用,直接在8号层后面输入名称PLAYER即可新建图层,如图4-45所示。

添加PLAYER图层后,选择PlayerModel,将检视视图的Layer属性设置为PLAYER图层。保存图层时,如果模型在层次视图中有子对象, IDE会询问是否适用于全部模型。此时选择Yes, Unity会将此设置应用于其下全部模型。

指定图层后,将Blob Shadow Projector按影器的Ignore Layers属性设置为PLAYER图层。之后,PlayerModel本身不会被投射阴影,如图4-46所示,仅能看到投影器在地面上生成的阴影。

设置Ignore Layers后,即使将Near Clip Plane值重新修改为原来的0.1, Player上也不会有阴能
提示Layer, Sorting Layers

与Photoshop的图层不同, Unity中使用的图层没有2-order,换言之, Unity不是以物理层次分离游戏对象的,而是将特定的游戏对象编组,以决定是否受某个特定效果的影响。其具有代表性的功能有:光源发射的光可以选择性地只影响特定图层、从摄像机的可视视角中排除特定图层。

4.3后续版本添加了2D相关功能, Unity也新添加了Sorting Layers, Sorting Layers用于处理2D游戏背景的远景与近景,可以为之指定z-ordero

# 运用平面网格制作阴影

用投影器制作阴影比较便利,还可以用平面网格(Plane Mesh )制作阴影,这也是移动设备游戏中常用的方式。先删除或禁用前面添加的Blob Shadow Projetor 影器,然后进行下列操作。

在菜单中选择GameObject-3D Objeet-Quad,生成Quad模型,将其拖曳到层次视图Player道戏对象下,设置Transform属性,如表4-6所示。

删除Quad模型中默认添加的Mesh Collider组件,该组件用于处理碰撞效果,第5章将详细讲解。

下面为该模型附上阴影纹理。在项目视图05. Models/AngryBotPlayrMaterials文件夹中新建材质,重命名为shadow,然后将05. Models/AngryBotPlayer Texture文件夹中的shadow纹理拖曳到检视视图Abledo插槽,并将Rendering Mode属性设置为Fade,

将Quad模型Mesh Renderer组件效果如图4-49所示。
ials属性设置为附上纹理的阴影材质shadow,完成阴影制

以上讲解了3种阴影制作方法,最后的平面网格方式计算负荷最小。但如果游戏场景中有弯曲或倾斜的路面,角色阴影会淹没在其他网格中,可能最终导致阴影无法显示。

# 小结
本章讲解了游戏对象与组件之间的关系,编写了可以使角色进行基本移动和旋转的脚本,这是开发中最需要明确掌握的内容。不过,即使各位没有完全理解也不必担心,先学习第5章和第6章吧。